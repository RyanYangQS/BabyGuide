{"version":3,"file":"user.js","sources":["src/store/modules/user.ts"],"sourcesContent":["import { defineStore } from 'pinia'\nimport { ref } from 'vue'\nimport { userLogin as userLoginApi } from '../../api'\n\nexport interface User {\n  userId: string\n  openid: string\n  nickName?: string\n  avatarUrl?: string\n  isNewUser?: boolean\n}\n\nexport const useUserStore = defineStore('user', () => {\n  const isLoggedIn = ref(false)\n  const userInfo = ref<User | null>(null)\n  const loading = ref(false)\n\n  /**\n   * 登录（获取 openid）\n   */\n  async function login() {\n    loading.value = true\n    \n    try {\n      const res = await userLoginApi()\n      \n      if (res.success && res.data) {\n        isLoggedIn.value = true\n        userInfo.value = {\n          userId: res.data.userId,\n          openid: res.data.openid,\n          isNewUser: res.data.isNewUser\n        }\n        \n        // 保存登录状态\n        uni.setStorageSync('isLoggedIn', true)\n        uni.setStorageSync('userId', res.data.userId)\n        \n        return { success: true, isNewUser: res.data.isNewUser }\n      } else {\n        return { success: false, errMsg: res.errMsg }\n      }\n    } catch (err: any) {\n      console.error('登录失败:', err)\n      return { success: false, errMsg: err.message || '登录失败' }\n    } finally {\n      loading.value = false\n    }\n  }\n\n  /**\n   * 更新用户信息（头像、昵称）\n   */\n  function updateUserInfo(nickName: string, avatarUrl: string) {\n    if (userInfo.value) {\n      userInfo.value.nickName = nickName\n      userInfo.value.avatarUrl = avatarUrl\n      \n      // 保存到本地\n      uni.setStorageSync('userNickName', nickName)\n      uni.setStorageSync('userAvatarUrl', avatarUrl)\n    }\n  }\n\n  /**\n   * 检查登录状态\n   */\n  function checkLoginStatus() {\n    const loggedIn = uni.getStorageSync('isLoggedIn')\n    const userId = uni.getStorageSync('userId')\n    const nickName = uni.getStorageSync('userNickName')\n    const avatarUrl = uni.getStorageSync('userAvatarUrl')\n    \n    if (loggedIn && userId) {\n      isLoggedIn.value = true\n      userInfo.value = {\n        userId,\n        openid: '',\n        nickName,\n        avatarUrl\n      }\n      return true\n    }\n    return false\n  }\n\n  /**\n   * 退出登录\n   */\n  function logout() {\n    isLoggedIn.value = false\n    userInfo.value = null\n    uni.removeStorageSync('isLoggedIn')\n    uni.removeStorageSync('userId')\n    uni.removeStorageSync('userNickName')\n    uni.removeStorageSync('userAvatarUrl')\n  }\n\n  return {\n    isLoggedIn,\n    userInfo,\n    loading,\n    login,\n    updateUserInfo,\n    checkLoginStatus,\n    logout\n  }\n})\n"],"names":["defineStore","ref","userLoginApi","uni"],"mappings":";;;AAYa,MAAA,eAAeA,cAAAA,YAAY,QAAQ,MAAM;AAC9C,QAAA,aAAaC,kBAAI,KAAK;AACtB,QAAA,WAAWA,kBAAiB,IAAI;AAChC,QAAA,UAAUA,kBAAI,KAAK;AAKzB,iBAAe,QAAQ;AACrB,YAAQ,QAAQ;AAEZ,QAAA;AACI,YAAA,MAAM,MAAMC,cAAAA;AAEd,UAAA,IAAI,WAAW,IAAI,MAAM;AAC3B,mBAAW,QAAQ;AACnB,iBAAS,QAAQ;AAAA,UACf,QAAQ,IAAI,KAAK;AAAA,UACjB,QAAQ,IAAI,KAAK;AAAA,UACjB,WAAW,IAAI,KAAK;AAAA,QAAA;AAIlBC,sBAAAA,MAAA,eAAe,cAAc,IAAI;AACrCA,sBAAA,MAAI,eAAe,UAAU,IAAI,KAAK,MAAM;AAE5C,eAAO,EAAE,SAAS,MAAM,WAAW,IAAI,KAAK;MAAU,OACjD;AACL,eAAO,EAAE,SAAS,OAAO,QAAQ,IAAI,OAAO;AAAA,MAC9C;AAAA,aACO,KAAU;AACjBA,oBAAA,MAAA,MAAA,SAAA,mCAAc,SAAS,GAAG;AAC1B,aAAO,EAAE,SAAS,OAAO,QAAQ,IAAI,WAAW;IAAO,UACvD;AACA,cAAQ,QAAQ;AAAA,IAClB;AAAA,EACF;AAKS,WAAA,eAAe,UAAkB,WAAmB;AAC3D,QAAI,SAAS,OAAO;AAClB,eAAS,MAAM,WAAW;AAC1B,eAAS,MAAM,YAAY;AAGvBA,oBAAAA,MAAA,eAAe,gBAAgB,QAAQ;AACvCA,oBAAAA,MAAA,eAAe,iBAAiB,SAAS;AAAA,IAC/C;AAAA,EACF;AAKA,WAAS,mBAAmB;AACpB,UAAA,WAAWA,cAAAA,MAAI,eAAe,YAAY;AAC1C,UAAA,SAASA,cAAAA,MAAI,eAAe,QAAQ;AACpC,UAAA,WAAWA,cAAAA,MAAI,eAAe,cAAc;AAC5C,UAAA,YAAYA,cAAAA,MAAI,eAAe,eAAe;AAEpD,QAAI,YAAY,QAAQ;AACtB,iBAAW,QAAQ;AACnB,eAAS,QAAQ;AAAA,QACf;AAAA,QACA,QAAQ;AAAA,QACR;AAAA,QACA;AAAA,MAAA;AAEK,aAAA;AAAA,IACT;AACO,WAAA;AAAA,EACT;AAKA,WAAS,SAAS;AAChB,eAAW,QAAQ;AACnB,aAAS,QAAQ;AACjBA,wBAAI,kBAAkB,YAAY;AAClCA,wBAAI,kBAAkB,QAAQ;AAC9BA,wBAAI,kBAAkB,cAAc;AACpCA,wBAAI,kBAAkB,eAAe;AAAA,EACvC;AAEO,SAAA;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EAAA;AAEJ,CAAC;;"}