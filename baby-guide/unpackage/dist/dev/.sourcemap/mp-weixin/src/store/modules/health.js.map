{"version":3,"file":"health.js","sources":["src/store/modules/health.ts"],"sourcesContent":["import { defineStore } from 'pinia'\nimport { computed, ref } from 'vue'\nimport * as api from '../../api'\nimport type { MedicineRecord, SymptomRecord, TemperatureRecord } from '../../types'\nimport { HealthStatus, getHealthStatus } from '../../utils/theme'\n\nexport const useHealthStore = defineStore('health', () => {\n  const temperatureRecords = ref<TemperatureRecord[]>([])\n  const medicineRecords = ref<MedicineRecord[]>([])\n  const symptomRecords = ref<SymptomRecord[]>([])\n  const currentHealthStatus = ref<HealthStatus>(HealthStatus.Healthy)\n  const loading = ref(false)\n  \n  const latestTemperature = computed(() => {\n    if (temperatureRecords.value.length === 0) return null\n    return temperatureRecords.value[0]\n  })\n  \n  const todayTemperatureRecords = computed(() => {\n    const today = new Date().toDateString()\n    return temperatureRecords.value.filter(\n      record => new Date(record.measureTime).toDateString() === today\n    )\n  })\n  \n  const todayMedicineRecords = computed(() => {\n    const today = new Date().toDateString()\n    return medicineRecords.value.filter(\n      record => new Date(record.takeTime).toDateString() === today\n    )\n  })\n  \n  function setTemperatureRecords(records: TemperatureRecord[]) {\n    temperatureRecords.value = records.sort(\n      (a, b) => new Date(b.measureTime).getTime() - new Date(a.measureTime).getTime()\n    )\n    if (records.length > 0) {\n      const latest = records[0]\n      currentHealthStatus.value = getHealthStatus(latest.temperature)\n    }\n  }\n  \n  async function fetchTemperatureRecords(childId: string, startDate?: string, endDate?: string) {\n    loading.value = true\n    const res = await api.getTemperatureRecords({ childId, startDate, endDate })\n    loading.value = false\n    \n    if (res.success && res.data) {\n      setTemperatureRecords(res.data.list)\n    }\n    return res\n  }\n  \n  async function addTemperatureRecordApi(data: {\n    childId: string\n    temperature: number\n    measureTime: string\n    measurePart?: 'oral' | 'axillary' | 'rectal' | 'ear'\n    notes?: string\n  }) {\n    const res = await api.addTemperature(data)\n    \n    if (res.success && res.data) {\n      addTemperatureRecord(res.data as TemperatureRecord)\n    }\n    return res\n  }\n  \n  function addTemperatureRecord(record: TemperatureRecord) {\n    temperatureRecords.value.unshift(record)\n    temperatureRecords.value.sort(\n      (a, b) => new Date(b.measureTime).getTime() - new Date(a.measureTime).getTime()\n    )\n    currentHealthStatus.value = getHealthStatus(record.temperature)\n  }\n  \n  function setMedicineRecords(records: MedicineRecord[]) {\n    medicineRecords.value = records.sort(\n      (a, b) => new Date(b.takeTime).getTime() - new Date(a.takeTime).getTime()\n    )\n  }\n  \n  async function fetchMedicineRecords(childId: string, startDate?: string, endDate?: string) {\n    loading.value = true\n    const res = await api.getMedicineRecords({ childId, startDate, endDate })\n    loading.value = false\n    \n    if (res.success && res.data) {\n      setMedicineRecords(res.data.list)\n    }\n    return res\n  }\n  \n  async function addMedicineRecordApi(data: {\n    childId: string\n    medicineId?: string\n    medicineName: string\n    dosage?: string\n    unit?: string\n    takeTime: string\n    notes?: string\n  }) {\n    const res = await api.addMedicineRecord(data)\n    \n    if (res.success && res.data) {\n      addMedicineRecord(res.data as MedicineRecord)\n    }\n    return res\n  }\n  \n  function addMedicineRecord(record: MedicineRecord) {\n    medicineRecords.value.unshift(record)\n  }\n  \n  function setSymptomRecords(records: SymptomRecord[]) {\n    symptomRecords.value = records.sort(\n      (a, b) => new Date(b.recordTime).getTime() - new Date(a.recordTime).getTime()\n    )\n  }\n  \n  async function fetchSymptomRecords(childId: string, startDate?: string, endDate?: string) {\n    loading.value = true\n    const res = await api.getSymptomRecords({ childId, startDate, endDate })\n    loading.value = false\n    \n    if (res.success && res.data) {\n      setSymptomRecords(res.data.list)\n    }\n    return res\n  }\n  \n  async function addSymptomRecordApi(data: {\n    childId: string\n    symptoms: string[]\n    severity?: 'mild' | 'moderate' | 'severe'\n    recordTime: string\n    notes?: string\n  }) {\n    const res = await api.addSymptomRecord(data)\n    \n    if (res.success && res.data) {\n      addSymptomRecord(res.data as SymptomRecord)\n    }\n    return res\n  }\n  \n  function addSymptomRecord(record: SymptomRecord) {\n    symptomRecords.value.unshift(record)\n  }\n  \n  async function fetchHealthOverview(childId: string) {\n    loading.value = true\n    const res = await api.getHealthOverview(childId)\n    loading.value = false\n    \n    if (res.success && res.data) {\n      const { latestTemperature, healthStatus } = res.data\n      currentHealthStatus.value = healthStatus\n      if (latestTemperature) {\n        const exists = temperatureRecords.value.find(r => r._id === latestTemperature._id)\n        if (!exists) {\n          temperatureRecords.value.unshift(latestTemperature)\n        }\n      }\n    }\n    return res\n  }\n  \n  function clearRecords() {\n    temperatureRecords.value = []\n    medicineRecords.value = []\n    symptomRecords.value = []\n    currentHealthStatus.value = HealthStatus.Healthy\n  }\n  \n  return {\n    temperatureRecords,\n    medicineRecords,\n    symptomRecords,\n    currentHealthStatus,\n    loading,\n    latestTemperature,\n    todayTemperatureRecords,\n    todayMedicineRecords,\n    setTemperatureRecords,\n    fetchTemperatureRecords,\n    addTemperatureRecordApi,\n    addTemperatureRecord,\n    setMedicineRecords,\n    fetchMedicineRecords,\n    addMedicineRecordApi,\n    addMedicineRecord,\n    setSymptomRecords,\n    fetchSymptomRecords,\n    addSymptomRecordApi,\n    addSymptomRecord,\n    fetchHealthOverview,\n    clearRecords\n  }\n})\n"],"names":["defineStore","ref","HealthStatus","computed","getHealthStatus","api.getTemperatureRecords","api.addTemperature","api.getMedicineRecords","api.addMedicineRecord","api.getSymptomRecords","api.addSymptomRecord","api.getHealthOverview","latestTemperature"],"mappings":"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"}