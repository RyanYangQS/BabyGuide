{"version":3,"file":"children.js","sources":["src/store/modules/children.ts"],"sourcesContent":["import { defineStore } from 'pinia'\nimport { ref } from 'vue'\nimport * as api from '../../api'\nimport type { Child } from '../../types'\n\nexport const useChildrenStore = defineStore('children', () => {\n  const currentChild = ref<Child | null>(null)\n  const childrenList = ref<Child[]>([])\n  const loading = ref(false)\n\n  \n  function setCurrentChild(child: Child | null) {\n    currentChild.value = child\n    if (child) {\n      uni.setStorageSync('currentChildId', child._id)\n    } else {\n      uni.removeStorageSync('currentChildId')\n    }\n  }\n  \n  function setChildrenList(list: Child[]) {\n    childrenList.value = list\n  }\n  \n  async function fetchChildren() {\n    loading.value = true\n    const res = await api.getChildren()\n    loading.value = false\n    \n    if (res.success && res.data) {\n      childrenList.value = res.data\n      restoreCurrentChild()\n    }\n    return res\n  }\n  \n  async function addChildApi(data: {\n    name: string\n    gender: 'male' | 'female'\n    birthday: string\n    bloodType?: string\n    allergies?: string[]\n    notes?: string\n  }) {\n    const res = await api.addChild(data)\n    \n    if (res.success && res.data) {\n      childrenList.value.push(res.data as Child)\n      if (!currentChild.value) {\n        setCurrentChild(res.data as Child)\n      }\n    }\n    return res\n  }\n  \n  function addChild(child: Child) {\n    childrenList.value.push(child)\n  }\n  \n  async function updateChildApi(data: {\n    childId: string\n    name?: string\n    gender?: 'male' | 'female'\n    birthday?: string\n    bloodType?: string\n    allergies?: string[]\n    notes?: string\n    avatar?: string\n  }) {\n    const res = await api.updateChild(data)\n    \n    if (res.success) {\n      const index = childrenList.value.findIndex(c => c._id === data.childId)\n      if (index !== -1) {\n        Object.assign(childrenList.value[index], data)\n        if (currentChild.value?._id === data.childId) {\n          Object.assign(currentChild.value, data)\n        }\n      }\n    }\n    return res\n  }\n  \n  function updateChild(child: Child) {\n    const index = childrenList.value.findIndex(c => c._id === child._id)\n    if (index !== -1) {\n      childrenList.value[index] = child\n      if (currentChild.value?._id === child._id) {\n        currentChild.value = child\n      }\n    }\n  }\n  \n  async function deleteChildApi(childId: string) {\n    const res = await api.deleteChild(childId)\n    \n    if (res.success) {\n      childrenList.value = childrenList.value.filter(c => c._id !== childId)\n      if (currentChild.value?._id === childId) {\n        currentChild.value = childrenList.value[0] || null\n        if (currentChild.value) {\n          uni.setStorageSync('currentChildId', currentChild.value._id)\n        }\n      }\n    }\n    return res\n  }\n  \n  function removeChild(childId: string) {\n    childrenList.value = childrenList.value.filter(c => c._id !== childId)\n    if (currentChild.value?._id === childId) {\n      currentChild.value = childrenList.value[0] || null\n    }\n  }\n  \n  function restoreCurrentChild() {\n    const currentChildId = uni.getStorageSync('currentChildId')\n    if (currentChildId && childrenList.value.length > 0) {\n      const child = childrenList.value.find(c => c._id === currentChildId)\n      if (child) {\n        currentChild.value = child\n      } else if (childrenList.value.length > 0) {\n        currentChild.value = childrenList.value[0]\n      }\n    } else if (childrenList.value.length > 0) {\n      currentChild.value = childrenList.value[0]\n    }\n  }\n  \n  return {\n    currentChild,\n    childrenList,\n    loading,\n    setCurrentChild,\n    setChildrenList,\n    fetchChildren,\n    addChildApi,\n    addChild,\n    updateChildApi,\n    updateChild,\n    deleteChildApi,\n    removeChild,\n    restoreCurrentChild\n  }\n})\n"],"names":["defineStore","ref","uni","api.getChildren","api.addChild","api.updateChild","api.deleteChild"],"mappings":"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"}